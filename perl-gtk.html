<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="en" xml:lang="en">
<head>
<title>Perl/Gtk</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2010-11-20 18:41:18 IST"/>
<meta name="author" content="Dov Grobgeld"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<!-- configuration parameters --> <meta name='duration' content='5' /> <meta name='font-size-adjustment' content='2' /> <!-- style sheet links --> <link rel='stylesheet' href='slidy.css' type='text/css' /> <!-- HTMTLSLIDY JS --> <script src='htmlslidy-slides.js' type='text/javascript'></script> <script src='slidy.js' type='text/javascript'></script> <script src='jquery.js' type='text/javascript'></script> <script src='org-slidy-slides.js' type='text/javascript'></script>
<link rel='stylesheet' href='blue.css' type='text/css'  /> <link rel='stylesheet' href='dov.css' type='text/css'  /> 
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="content">

</div><div class='background'><img alt='' id='head-icon' src='graphics/gtk-logo.png' /><img alt='' id='head-logo' src='graphics/dov-logo.png' /></a></object></div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Perl/Gtk </h2>
<div class="outline-text-2" id="text-1">

<ul>
<li id="sec-1_1">By Dov Grobgeld <br/>
</li>
</ul>
<ul>
<li id="sec-1_2">Using Perl with Gtk <br/>

<p>
<img src="graphics/gtk-logo.png"  alt="graphics/gtk-logo.png" /> + <img src="graphics/camel.jpg"  alt="graphics/camel.jpg" /> 
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">History </h2>
<div class="outline-text-2" id="text-2">

<ul>
<li id="sec-2_1">Gtk <br/>
<ul>
<li>
Was developed to replace Motif for version 1.0 of Gimp. 
</li>
<li>
Originally "the <b>G</b> imp <b>T</b> ool <b>K</b> it".
</li>
<li>
Major toolkit on Windows, MacOSX, Windows.
</li>
<li>
Great internationalization.  
</li>
<li>
Current version is 2.8. 3.0 under development.
</li>
<li>
Written in object-oriented C and easy to create bindings for it. 
</li>
<li>
Build around GObject
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-2_2">Gtk Perl history <br/>
<ul>
<li>
Old bindings 
</li>
<li>
Closely maps C-API
</li>
</ul>


</li>
</ul>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Hello world </h2>
<div class="outline-text-2" id="text-3">

<ul>
<li id="sec-3_1">Structure <br/>
<ul>
<li>
Load Gtk2 module
</li>
<li>
Create widgets and setup callbacks
</li>
<li>
Enter main gtk mainloop
</li>
</ul>




<pre class="src src-perl"><span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$window</span> = Gtk2::Window-&gt;new;
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$label</span> = Gtk2::Label-&gt;new(<span style="color: #008b00;">"Hello world!"</span>);
$window-&gt;add($label);
$window-&gt;show_all();

Gtk2-&gt;main;
</pre>


<p>
<img src="graphics/hello_world.png"  alt="graphics/hello_world.png" />
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Callbacks </h2>
<div class="outline-text-2" id="text-4">

<ul>
<li>
callbacks define behavior on events.
</li>
</ul>




<pre class="src src-perl"><span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$window</span> = Gtk2::Window-&gt;new;
$window-&gt;set_title (<span style="color: #008b00;">"Hello world"</span>);
$window-&gt;signal_connect (<span style="color: #008b00;">destroy</span> =&gt; <span style="color: #a020f0;">sub</span> { Gtk2-&gt;main_quit; });

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$button</span> = Gtk2::Button-&gt;new(<span style="color: #008b00;">"Hello world!"</span>);
$button-&gt;signal_connect(<span style="color: #008b00;">clicked</span>=&gt; <span style="color: #a020f0;">sub</span> { Gtk2-&gt;main_quit; });

$window-&gt;add($button);
$window-&gt;show_all();

Gtk2-&gt;main;
</pre>



<p>
<img src="graphics/hello_world2.png"  alt="graphics/hello_world2.png" />
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">Object oriented Gtk (the Perl Way) </h2>
<div class="outline-text-2" id="text-5">

<ul>
<li id="sec-5_1">Widgets are hashes that may be used to store member data. <br/>



<pre class="src src-perl"><span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;

<span style="color: #a020f0;">package</span> <span style="color: #0000ff;">MyApp</span>;
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">base</span> <span style="color: #008b00;">'Gtk2::Window'</span>;

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">new</span> {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$self</span> = <span style="color: #228b22;">bless</span> Gtk2::Window-&gt;new(), <span style="color: #66cd00;">shift</span>();

    $self-&gt;set_title (<span style="color: #008b00;">"Hello world"</span>);
    $self-&gt;{<span style="color: #008b00;">button</span>} = Gtk2::Button-&gt;new(<span style="color: #008b00;">"Hello world!"</span>);
    $self-&gt;{<span style="color: #008b00;">button</span>}-&gt;signal_connect(<span style="color: #008b00;">clicked</span>=&gt; \&amp;clicked,
                                    $self);
    $self-&gt;add($self-&gt;{<span style="color: #008b00;">button</span>});
    <span style="color: #a020f0;">return</span> $self;
}

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">clicked</span> {
    <span style="color: #a020f0;">my</span>(<span style="color: #b8860b;">$widget</span>, <span style="color: #b8860b;">$self</span>) = <span style="color: #0000ff; background-color: #eeeed1; font-weight: bold;">@_</span>;
    $self-&gt;{<span style="color: #008b00;">button</span>}-&gt;set_label(<span style="color: #008b00;">"Bye!"</span>)
}

<span style="color: #a020f0;">package</span> <span style="color: #0000ff;">main</span>;
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$app</span> = new MyApp;
$app-&gt;signal_connect (<span style="color: #008b00;">destroy</span> =&gt; <span style="color: #a020f0;">sub</span> { Gtk2-&gt;main_quit; });
$app-&gt;show_all();

Gtk2-&gt;main;
</pre>



</li>
</ul>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">Why are perl objects not enough? </h2>
<div class="outline-text-2" id="text-6">

<ul>
<li>
No signals.
</li>
<li>
No properties (set() and get())
</li>
<li>
But "real" widgets are hairy. Example from the perl gtk manual.
</li>
</ul>




<pre class="src src-perl"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/perl -w
</span>
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">strict</span>;

<span style="color: #a020f0;">package</span> <span style="color: #0000ff;">Mup::ColorButton</span>;

<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span>;

<span style="color: #b22222;"># </span><span style="color: #b22222;">this big hairy statement registers our Glib::Object-derived class
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">and sets up all the signals and properties for it.
</span><span style="color: #a020f0;">use</span> Glib::Object::Subclass
  Gtk2::Button::,
  <span style="color: #008b00;">signals</span> =&gt; {
      <span style="color: #b22222;"># </span><span style="color: #b22222;">with an empty hash for color_changed, we use all defaults,
</span>      <span style="color: #b22222;"># </span><span style="color: #b22222;">which results in a signal which receives no extra parameters[2]
</span>      <span style="color: #b22222;"># </span><span style="color: #b22222;">and returns no value.
</span>      <span style="color: #008b00;">color_changed</span> =&gt; {},
      <span style="color: #b22222;"># </span><span style="color: #b22222;">by supplying a subroutine reference for an existing signal,
</span>      <span style="color: #b22222;"># </span><span style="color: #b22222;">we override the default handler for the class; this is how
</span>      <span style="color: #b22222;"># </span><span style="color: #b22222;">you override virtual functions on Glib::Objects.
</span>      <span style="color: #008b00;">show</span> =&gt; \&amp;on_show,
  },
  <span style="color: #008b00;">properties</span> =&gt; [
      Glib::ParamSpec-&gt;<span style="color: #228b22;">int</span> (
          <span style="color: #008b00;">'red'</span>,                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">name
</span>          <span style="color: #008b00;">'Red'</span>,                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">nickname
</span>          <span style="color: #008b00;">'The Red component of the RGB color'</span>,       <span style="color: #b22222;">#</span><span style="color: #b22222;">blurb
</span>          0,                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">min
</span>          0xffff,                                     <span style="color: #b22222;"># </span><span style="color: #b22222;">max
</span>          0xffff,                                     <span style="color: #b22222;"># </span><span style="color: #b22222;">default
</span>          [<span style="color: #66cd00;">qw</span><span style="color: #008b00;">/readable writable/</span>]                     <span style="color: #b22222;">#</span><span style="color: #b22222;">flags
</span>         ),
      Glib::ParamSpec-&gt;<span style="color: #228b22;">int</span> (
          <span style="color: #008b00;">'green'</span>, <span style="color: #008b00;">'Green'</span>, <span style="color: #008b00;">'The Green component of the RGB color'</span>,
          0, 0xffff, 0xffff, [<span style="color: #66cd00;">qw</span><span style="color: #008b00;">/readable writable/</span>]
         ),
      Glib::ParamSpec-&gt;<span style="color: #228b22;">int</span> (
          <span style="color: #008b00;">'blue'</span>, <span style="color: #008b00;">'Blue'</span>, <span style="color: #008b00;">'The Blue component of the RGB color'</span>,
          0, 0xffff, 0xffff, [<span style="color: #66cd00;">qw</span><span style="color: #008b00;">/readable writable/</span>]
         ),
     ]
  ;

<span style="color: #b22222;"># </span><span style="color: #b22222;">as part of creating the C object, Glib will call the INIT_INSTANCE
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">method to, surprise, initialize the instance.  this is not an inherited
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">method; it will be called with a fully-qualified package name.
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">most of what we used to have in the constructor goes here.
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in fact, we just inherit new() from the base class, because it does
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">everything we need it to.
</span><span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">INIT_INSTANCE</span> {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$self</span> = <span style="color: #66cd00;">shift</span>;
    $self-&gt;{<span style="color: #008b00;">red</span>} = 0xffff;
    $self-&gt;{<span style="color: #008b00;">green</span>} = 0xffff;
    $self-&gt;{<span style="color: #008b00;">blue</span>} = 0xffff;
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$frame</span> = Gtk2::Frame-&gt;new;
    $frame-&gt;set_border_width (3);
    $frame-&gt;set_shadow_type (<span style="color: #008b00;">'etched-in'</span>);
    $self-&gt;add ($frame);
    $frame-&gt;show;
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$event_box</span> = Gtk2::EventBox-&gt;new;
    $event_box-&gt;set_size_request (14, 14);
    $frame-&gt;add ($event_box);
    $event_box-&gt;show;
    $self-&gt;{<span style="color: #008b00;">colorbox</span>} = $event_box;
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">in a more ambitious widget, we'd probably define GET_PROPERTY
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">and SET_PROPERTY to do some custom stuff... for our purposes,
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">however, the default implementation provided by Glib::Object::Subclass
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">is sufficient.  (it sets the property values as hash members in the
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">instance variable.)
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">here we need to override the show method to set the color the
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">first time we go onscreen, because we can't do that in the
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">initializer (the GdkWindow does not exist yet).
</span><span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">on_show</span> {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$self</span> = <span style="color: #66cd00;">shift</span>;
    $self-&gt;set_color (<span style="color: #008b00;">red</span> =&gt; $self-&gt;{<span style="color: #008b00;">red</span>},
                      <span style="color: #008b00;">green</span> =&gt; $self-&gt;{<span style="color: #008b00;">green</span>},
                      <span style="color: #008b00;">blue</span> =&gt; $self-&gt;{<span style="color: #008b00;">blue</span>});
    <span style="color: #b22222;"># </span><span style="color: #b22222;">perl code that needs to call the parent class usually does something
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">like  $self-&gt;SUPER::methodname ---- however, class_closures for
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">for Glib::Objects are not inheritable in that way; the code to which
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">we need to chain may not even be perl code.  Glib provides this
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">method to provide that functionality, instead.
</span>    $self-&gt;signal_chain_from_overridden;
}

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">set_color</span> {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$self</span> = <span style="color: #66cd00;">shift</span>;
    <span style="color: #a020f0;">my</span> <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">%params</span> = <span style="color: #0000ff; background-color: #eeeed1; font-weight: bold;">@_</span>;
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$color</span> = Gtk2::Gdk::Color-&gt;new (<span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$params</span>{<span style="color: #008b00;">red</span>},
                                       <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$params</span>{<span style="color: #008b00;">green</span>},
                                       <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$params</span>{<span style="color: #008b00;">blue</span>});
    $self-&gt;{<span style="color: #008b00;">colorbox</span>}-&gt;get_colormap-&gt;alloc_color ($color, 0, 1);
    $self-&gt;{<span style="color: #008b00;">colorbox</span>}-&gt;modify_bg (<span style="color: #008b00;">'normal'</span>, $color);
    $self-&gt;{<span style="color: #008b00;">colorbox</span>}-&gt;modify_bg (<span style="color: #008b00;">'active'</span>, $color);
    $self-&gt;{<span style="color: #008b00;">colorbox</span>}-&gt;modify_bg (<span style="color: #008b00;">'prelight'</span>, $color);
    $self-&gt;{<span style="color: #008b00;">red</span>} = <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$params</span>{<span style="color: #008b00;">red</span>};
    $self-&gt;{<span style="color: #008b00;">green</span>} = <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$params</span>{<span style="color: #008b00;">green</span>};
    $self-&gt;{<span style="color: #008b00;">blue</span>} = <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$params</span>{<span style="color: #008b00;">blue</span>};
    <span style="color: #b22222;"># </span><span style="color: #b22222;">emit the color-changed signal.  note again that the signal
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">name treats - and _ as equivalent.
</span>    $self-&gt;signal_emit (<span style="color: #008b00;">'color-changed'</span>);
}

<span style="color: #a020f0;">package</span> <span style="color: #0000ff;">main</span>;

<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> -init;

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$window</span> = Gtk2::Window-&gt;new;
$window-&gt;set_title (<span style="color: #008b00;">'Color buttons'</span>);
$window-&gt;set_border_width (6);
$window-&gt;signal_connect (<span style="color: #008b00;">delete_event</span> =&gt; <span style="color: #a020f0;">sub</span> { Gtk2-&gt;main_quit; 1 });

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$vbox</span> = Gtk2::VBox-&gt;new;
$window-&gt;add ($vbox);
$vbox-&gt;show;

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$foo</span> = Mup::ColorButton-&gt;new (<span style="color: #008b00;">red</span> =&gt; 0xaaaa,
                                 <span style="color: #008b00;">green</span> =&gt; 0x0,
                                 <span style="color: #008b00;">blue</span> =&gt; 0xffff);
$vbox-&gt;pack_start ($foo, 1, 1, 0);
$foo-&gt;show;

$foo-&gt;signal_connect (<span style="color: #008b00;">clicked</span> =&gt; <span style="color: #a020f0;">sub</span> {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$self</span> = <span style="color: #66cd00;">shift</span>;
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$dialog</span> = Gtk2::ColorSelectionDialog
      -&gt;new(<span style="color: #008b00;">'pick a color'</span>);
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$c</span> = Gtk2::Gdk::Color-&gt;new ($self-&gt;{<span style="color: #008b00;">red</span>},
                                   $self-&gt;{<span style="color: #008b00;">green</span>},
                                   $self-&gt;{<span style="color: #008b00;">blue</span>});
    $self-&gt;{<span style="color: #008b00;">colorbox</span>}-&gt;get_colormap-&gt;alloc_color($c, 0, 1);
    $dialog-&gt;colorsel-&gt;set_current_color ($c);
    <span style="color: #a020f0;">if</span> (<span style="color: #008b00;">'ok'</span> <span style="color: #228b22;">eq</span> $dialog-&gt;run) {
        <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$c</span> = $dialog-&gt;colorsel-&gt;get_current_color;
        $self-&gt;set_color (<span style="color: #008b00;">red</span> =&gt; $c-&gt;red,
                          <span style="color: #008b00;">green</span> =&gt; $c-&gt;green,
                          <span style="color: #008b00;">blue</span> =&gt; $c-&gt;blue);
    }
    $dialog-&gt;destroy;
});

$foo-&gt;signal_connect(<span style="color: #008b00;">color_changed</span> =&gt; <span style="color: #a020f0;">sub</span> {
    <span style="color: #228b22;">warn</span> <span style="color: #008b00;">"the color changed - now "</span>
      . <span style="color: #228b22;">join</span> (<span style="color: #008b00;">", "</span>, <span style="color: #0000ff; background-color: #eeeed1; font-weight: bold;">$_</span>[0]-&gt;get (<span style="color: #66cd00;">qw</span><span style="color: #008b00;">/red green blue/</span>))
        . <span style="color: #008b00;">".  i should do something!"</span>;
});

$window-&gt;show;
Gtk2-&gt;main;

</pre>



</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">The Vala approach </h2>
<div class="outline-text-2" id="text-7">

<ul>
<li>
Vala is a C# like language modeled around GObjects 
</li>
<li>
Easy to interface vala (and any GObjects with perl). TBD!
</li>
</ul>




<pre class="example">using Gtk;

public class HelloWorld : Gtk.Window {
    construct {
        this.destroy += Gtk.main_quit;
        this.title = "Hello World";
        var button = new Button.with_label("Hello world");
        button.clicked += btn =&gt; {
            stdout.printf("Hello world!\n");
        };

        button.show();
        this.add(button);
    }
    
}

int main(string[] args) {
    Gtk.init(ref args);

    var hello_world = new HelloWorld();
    hello_world.show();

    Gtk.main();
    return 0;
}
</pre>


</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8">GObjects </h2>
<div class="outline-text-2" id="text-8">

<ul>
<li id="sec-8_1">Fundamentals <br/>
<ul>
<li>
GLib object system
</li>
<li>
Inheritance (though no multiple inheritence).
</li>
<li>
Fundamental types.
</li>
<li>
Derived types
</li>
<li>
Closures (allow interlanguage callbacks).
</li>
<li>
Signals (invoke closures)
</li>
</ul>


</li>
</ul>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9">GObjects and Gtk </h2>
<div class="outline-text-2" id="text-9">

<ul>
<li id="sec-9_1">Signals <br/>
<ul>
<li>
Widgets accept signals. 
</li>
<li>
Connect signals to user code through  <code>g_signal_connect()</code>
</li>
<li>
Inherit signals from parents
</li>
<li>
E.g. Widget accepts <code>key-press-event</code>, button adds <code>clicked</code>
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-9_2">Properties <br/>
<ul>
<li>
E.g. Frame has <code>label</code>, <code>label-xalign</code>, etc.
</li>
<li>
Set property through: <code>$widget-&gt;set(name=&gt; value)</code>
</li>
</ul>


</li>
</ul>
</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10">Packing widgets </h2>
<div class="outline-text-2" id="text-10">

<ul>
<li id="sec-10_1">Multichild packing <br/>
<ul>
<li>
Horizontal and vertical boxes through <code>Gtk2::HBox</code> and <code>Gtk2::VBox</code>
</li>
<li>
Tables through <code>Gtk2::Table</code>
</li>
<li>
Manual placement:  <code>Gtk2::Fixed</code> 
</li>
<li>
Expandable trees and list: <code>Gtk2::TreeView</code>
</li>
<li>
Tabs like a browser: <code>Gtk2::Notebook</code>
</li>
</ul>

</li>
</ul>
<ul>
<li id="sec-10_2">Single child packing: <br/>
<ul>
<li>
<code>GtkScrolledWindow</code> 
</li>
</ul>

</li>
</ul>
<ul>
<li id="sec-10_3">Two children: <br/>
<ul>
<li>
<code>Gtk::Paned</code>
</li>
</ul>


</li>
</ul>
</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11">VBox example </h2>
<div class="outline-text-2" id="text-11">




<pre class="src src-perl"><span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$window</span> = Gtk2::Window-&gt;new();
$window-&gt;set(<span style="color: #008b00;">title</span>=&gt;<span style="color: #008b00;">'Hello world'</span>);
$window-&gt;signal_connect (<span style="color: #008b00;">destroy</span> =&gt; <span style="color: #a020f0;">sub</span> { Gtk2-&gt;main_quit; });

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$vbox</span> = Gtk2::VBox-&gt;new();
$vbox-&gt;set(<span style="color: #008b00;">"border_width"</span>=&gt; 10);
$window-&gt;add($vbox);

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$label</span> = Gtk2::Label-&gt;new(<span style="color: #008b00;">"Hello world"</span>);
$vbox-&gt;pack_start($label,0,0,5); <span style="color: #b22222;"># </span><span style="color: #b22222;">expand?, fill?, padding
</span><span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$button</span> = Gtk2::Widget-&gt;new(<span style="color: #008b00;">"Gtk2::Button"</span>,
                               <span style="color: #008b00;">label</span>=&gt;<span style="color: #008b00;">"Quit"</span>);
$button-&gt;signal_connect(<span style="color: #008b00;">clicked</span>=&gt;\&amp;Gtk2::main_quit);
$vbox-&gt;pack_start($button, 0,0,5);<span style="text-decoration: underline;">  </span>

$window-&gt;show_all();

Gtk2-&gt;main;
</pre>



<p>
<img src="graphics/hello_world_pack.png"  alt="graphics/hello_world_pack.png" />
</p>
</div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12">Unicode! </h2>
<div class="outline-text-2" id="text-12">

<ul>
<li id="sec-12_1">Everything is Unicode so no problem with Hebrew. <br/>



<pre class="src src-perl"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/perl
</span>
<span style="color: #a020f0;">BEGIN</span> { <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$ENV</span>{<span style="color: #008b00;">LC_ALL</span>} = <span style="color: #008b00;">"he_IL"</span>; }<span style="text-decoration: underline;"> </span>

<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">utf8</span>;   <span style="color: #b22222;"># </span><span style="color: #b22222;">Needed for Hebrew
</span><span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;
:
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$label</span> = Gtk2::Label-&gt;new(<span style="color: #008b00;">"&#1513;&#1500;&#1493;&#1501; &#1506;&#1493;&#1500;&#1501;!"</span>);
$vbox-&gt;pack_start($label,0,0,5); <span style="color: #b22222;"># </span><span style="color: #b22222;">expand?, fill?, padding
</span>
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$button</span> = Gtk2::Widget-&gt;new(<span style="color: #008b00;">"Gtk2::Button"</span>,
                               <span style="color: #008b00;">label</span>=&gt;<span style="color: #008b00;">"&#1497;&#1510;&#1497;&#1488;&#1492;"</span>);
<span style="color: #b22222;"># </span><span style="color: #b22222;">Note how additional parameters are passed in callback
</span>$button-&gt;signal_connect(<span style="color: #008b00;">clicked</span>=&gt;\&amp;my_quit, [$label, $entry]);

$vbox-&gt;pack_start($button, 0,0,5);<span style="text-decoration: underline;">  </span>

$window-&gt;show_all();

Gtk2-&gt;main;

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">my_quit</span> {
    <span style="color: #a020f0;">my</span> (<span style="color: #b8860b;">$self</span>, <span style="color: #b8860b;">$args</span>) = <span style="color: #0000ff; background-color: #eeeed1; font-weight: bold;">@_</span>;
    <span style="color: #a020f0;">my</span> (<span style="color: #b8860b;">$label</span>, <span style="color: #b8860b;">$entry</span>) = <span style="color: #0000ff; background-color: #eeeed1; font-weight: bold;">@</span><span style="color: #b8860b;">$args</span>;

    $label-&gt;set(<span style="color: #008b00;">label</span>=&gt;$entry-&gt;get_text());
    $entry-&gt;set_text(<span style="color: #008b00;">""</span>);
    <span style="color: #b22222;"># </span><span style="color: #b22222;">Add a timeout event
</span>    Glib::Timeout-&gt;add(1500, <span style="color: #a020f0;">sub</span> { <span style="color: #a020f0;">exit</span> });
}
</pre>


<p>
<img src="graphics/hello_world_pack_screenshot2.png"  alt="graphics/hello_world_pack_screenshot2.png" />
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-13" class="outline-2">
<h2 id="sec-13">Styles </h2>
<div class="outline-text-2" id="text-13">

<ul>
<li id="sec-13_1">Colors and fonts are controlled by styles <br/>



<pre class="src src-perl"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/perl
</span>
<span style="color: #a020f0;">BEGIN</span> { <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$ENV</span>{<span style="color: #008b00;">LC_ALL</span>} = <span style="color: #008b00;">"he_IL"</span>; }<span style="text-decoration: underline;"> </span>

<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">utf8</span>;   <span style="color: #b22222;"># </span><span style="color: #b22222;">Needed for Hebrew
</span><span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;

Gtk2::Rc-&gt;parse_string(&lt;&lt;<span style="color: #191970;">__</span>);
<span style="color: #008b00;">include "/usr/local/share/themes/Bumblebee/gtk-2.0/gtkrc"

style "normal" {
    font_name ="serif 30"
}

style "my_entry" {
    font_name ="sans 25"
    text[NORMAL] = "#FF0000"
}

widget "*" style "normal"
widget "*Entry*" style "my_entry"
</span><span style="color: #191970;">__</span><span style="color: #b22222;">
</span>

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$window</span> = Gtk2::Window-&gt;new;
$window-&gt;set_title (<span style="color: #008b00;">"Hello world"</span>);
$window-&gt;signal_connect (<span style="color: #008b00;">destroy</span> =&gt; <span style="color: #a020f0;">sub</span> { Gtk2-&gt;main_quit; });

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$vbox</span> = Gtk2::VBox-&gt;new();
$vbox-&gt;set(<span style="color: #008b00;">"border_width"</span>=&gt; 10);
$window-&gt;add($vbox);

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$label</span> = Gtk2::Label-&gt;new(<span style="color: #008b00;">"&#1513;&#1500;&#1493;&#1501; &#1506;&#1493;&#1500;&#1501;!"</span>);
$vbox-&gt;pack_start($label,0,0,5); <span style="color: #b22222;"># </span><span style="color: #b22222;">expand?, fill?, padding
</span>
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$entry</span> = Gtk2::Entry-&gt;new();
$vbox-&gt;pack_start($entry,0,0,5);<span style="text-decoration: underline;"> </span>

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$button</span> = Gtk2::Widget-&gt;new(<span style="color: #008b00;">"Gtk2::Button"</span>,
                               <span style="color: #008b00;">label</span>=&gt;<span style="color: #008b00;">"&#1497;&#1510;&#1497;&#1488;&#1492;"</span>);
$button-&gt;signal_connect(<span style="color: #008b00;">clicked</span>=&gt;\&amp;my_quit);

$vbox-&gt;pack_start($button, 0,0,5);<span style="text-decoration: underline;">  </span>

$window-&gt;show_all();

Gtk2-&gt;main;

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">my_quit</span> {
    <span style="color: #66cd00;">print</span> <span style="color: #008b00;">"Lehitraot!\n"</span>;
    <span style="color: #a020f0;">exit</span>;
}
</pre>


<p>
<img src="graphics/hello_bumble.png"  alt="graphics/hello_bumble.png" />
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-14" class="outline-2">
<h2 id="sec-14">Connecting a style to a widget </h2>
<div class="outline-text-2" id="text-14">

<ul>
<li>
By naming a widget a style will stick to it 

</li>
</ul>




<pre class="src src-perl">Gtk2::Rc-&gt;parse_string(&lt;&lt;<span style="color: #191970;">__</span>);
<span style="color: #008b00;">style "big" {
    font_name ="serif 80"
}

style "normal" {
    font_name ="serif 30"
}

widget "*" style "normal"
widget "*big*" style "big"
</span><span style="color: #191970;">__</span><span style="color: #b22222;">
</span>
:
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$label</span> = Gtk2::Label-&gt;new(<span style="color: #008b00;">"Name:"</span>);
$label-&gt;set_name(<span style="color: #008b00;">"big"</span>);
:
</pre>



</div>

</div>

<div id="outline-container-15" class="outline-2">
<h2 id="sec-15">More widgets </h2>
<div class="outline-text-2" id="text-15">

<ul>
<li>
See <a href="file:///usr/share/doc/perl-Gtk2/gtk-demo/main.pl">/usr/share/doc/perl-Gtk2/gtk-demo/main.pl</a>
</li>
</ul>

<p><img src="graphics/gtk-demo.png"  alt="graphics/gtk-demo.png" />
</p>
</div>

</div>

<div id="outline-container-16" class="outline-2">
<h2 id="sec-16">Connecting to Glade </h2>
<div class="outline-text-2" id="text-16">

<ul>
<li>
Glade is a GUI builder that saves in xml format. 
</li>
<li>
The Gtk2::GladeXML module connects it to perl 
</li>
<li>
<code>glade-3 sms.glade</code>
</li>
</ul>

<p><img src="graphics/glade-3-editor.png"  alt="graphics/glade-3-editor.png" />
</p>
</div>

</div>

<div id="outline-container-17" class="outline-2">
<h2 id="sec-17">A SMS application through glade </h2>
<div class="outline-text-2" id="text-17">




<pre class="src src-perl"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/perl
</span>
<span style="color: #a020f0;">BEGIN</span> {
    <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$ENV</span>{<span style="color: #008b00;">LC_ALL</span>} = <span style="color: #008b00;">"he_IL"</span>;
}

<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> -init;
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2::GladeXML</span>;
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">strict</span>;

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$receiver</span>;   <span style="color: #b22222;"># </span><span style="color: #b22222;">Global variable for receiver
</span><span style="color: #a020f0;">my</span> <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">%db</span>;

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">read_db</span> {
    <span style="color: #228b22;">open</span>(DB, <span style="color: #008b00;">"&lt;:utf8"</span>, <span style="color: #008b00;">"mysms.dat"</span>);
    <span style="color: #a020f0;">while</span>(&lt;DB&gt;) {
        <span style="color: #66cd00;">chomp</span>;
        <span style="color: #a020f0;">my</span>(<span style="color: #b8860b;">$name</span>, <span style="color: #b8860b;">$number</span>) = <span style="color: #66cd00;">split</span>(<span style="color: #191970;">/</span><span style="color: #008b00;">,</span><span style="color: #191970;">/</span>);
        <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$db</span>{$name} = $number;
    }
    <span style="color: #228b22;">close</span>(DB);
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">Autoconnect routines
</span><span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">cb_quit</span> {
    Gtk2-&gt;main_quit;
}

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">on_send_clicked</span> {
    <span style="color: #66cd00;">print</span> <span style="color: #008b00;">"Sending sms to "</span>, <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$db</span>{$receiver}, <span style="color: #008b00;">"\n"</span>;
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">main
</span>read_db();
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$gladexml</span> = Gtk2::GladeXML-&gt;new(<span style="color: #008b00;">'sms.glade'</span>);
$gladexml-&gt;signal_autoconnect_from_package(<span style="color: #008b00;">'main'</span>);

<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$menu</span> = $gladexml-&gt;get_widget(<span style="color: #008b00;">'optionmenu1'</span>)-&gt;get_menu;
<span style="color: #a020f0;">for</span> <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$name</span> (<span style="color: #66cd00;">sort</span> <span style="color: #66cd00;">keys</span> <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">%db</span>) {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$item</span> = Gtk2::MenuItem-&gt;new(<span style="color: #008b00;">"$name - "</span> . <span style="color: #ff0000; background-color: #eeeed1; font-weight: bold; font-style: italic;">$db</span>{$name});
    $item-&gt;signal_connect(<span style="color: #008b00;">activate</span> =&gt; <span style="color: #a020f0;">sub</span> { $receiver = $name });
    $item-&gt;show();
    $menu-&gt;append($item);
}

Gtk2-&gt;main;
</pre>


<p>
<img src="graphics/sms.png"  alt="graphics/sms.png" />
</p>
</div>

</div>

<div id="outline-container-18" class="outline-2">
<h2 id="sec-18">The GooCanvas widget </h2>
<div class="outline-text-2" id="text-18">

<ul>
<li>
Several competing canvas widgets.
</li>
</ul>




<pre class="src src-perl"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/perl
</span>
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gnome2::Canvas</span>;

<span style="color: #a020f0;">my</span>(<span style="color: #b8860b;">$w_top</span>, <span style="color: #b8860b;">$w_canvas</span>);

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">create_widgets</span> {
    $w_top = Gtk2::Window-&gt;new;
    $w_top-&gt;signal_connect(<span style="color: #008b00;">destroy</span>=&gt; <span style="color: #a020f0;">sub</span> { <span style="color: #a020f0;">exit</span> });

    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$vbox</span> = Gtk2::VBox-&gt;new(0,0);
    $w_top-&gt;add($vbox);

    $w_canvas = Gnome2::Canvas-&gt;new_aa();
    $vbox-&gt;pack_start($w_canvas, 1,1,0);
    $w_canvas-&gt;set_size_request(300,300);
    $w_canvas-&gt;set_scroll_region (0, 0, 300, 300);

    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$quit</span> = Gtk2::Button-&gt;new(<span style="color: #008b00;">"Quit"</span>);
    $quit-&gt;signal_connect(<span style="color: #008b00;">clicked</span>=&gt; <span style="color: #a020f0;">sub</span> { <span style="color: #a020f0;">exit</span> });
    $vbox-&gt;pack_start($quit, 0, 0, 0);

    $w_top-&gt;show_all();
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">Callback for moving items on the canvas
</span><span style="color: #a020f0;">my</span> (<span style="color: #b8860b;">$dragging</span>, <span style="color: #b8860b;">$last_x</span>, <span style="color: #b8860b;">$last_y</span>);   <span style="color: #b22222;"># </span><span style="color: #b22222;">item_move static data
</span><span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">item_move</span> {
    <span style="color: #a020f0;">my</span>(<span style="color: #b8860b;">$item</span>, <span style="color: #b8860b;">$event</span>) = <span style="color: #0000ff; background-color: #eeeed1; font-weight: bold;">@_</span>;

    <span style="color: #a020f0;">if</span> ($event-&gt;type <span style="color: #228b22;">eq</span> <span style="color: #008b00;">"button-press"</span>) {
        $item-&gt;raise_to_top();
        $last_x = $event-&gt;<span style="color: #228b22;">x</span>;
        $last_y = $event-&gt;<span style="color: #66cd00;">y</span>;
        $dragging=1;
    }
    <span style="color: #a020f0;">elsif</span> ($event-&gt;type <span style="color: #228b22;">eq</span> <span style="color: #008b00;">"motion-notify"</span>) {
        <span style="color: #a020f0;">if</span> ($dragging) {
            <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$new_x</span> = $event-&gt;<span style="color: #228b22;">x</span>;
            <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$new_y</span> = $event-&gt;<span style="color: #66cd00;">y</span>;

            $item-&gt;move($new_x - $last_x,$new_y-$last_y);
            $last_x = $new_x;
            $last_y = $new_y;
        }
    }
    <span style="color: #a020f0;">elsif</span> ($event-&gt;type <span style="color: #228b22;">eq</span> <span style="color: #008b00;">"button-release"</span>) {
        $dragging = 0;
    }
}

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">place_objects_on_canvas</span> {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$root</span> = $w_canvas-&gt;root();

    <span style="color: #a020f0;">for</span> <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$p</span> ([50,50,  <span style="color: #008b00;">"green"</span>],
               [50,250, <span style="color: #008b00;">"orange"</span>],
               [250,50, <span style="color: #008b00;">"yellow"</span>],
               [250,250, <span style="color: #008b00;">"blue"</span>]) {

        <span style="color: #a020f0;">my</span>(<span style="color: #b8860b;">$x</span>,<span style="color: #b8860b;">$y</span>,<span style="color: #b8860b;">$color</span>) = <span style="color: #0000ff; background-color: #eeeed1; font-weight: bold;">@</span><span style="color: #b8860b;">$p</span>;

        <span style="color: #b22222;"># </span><span style="color: #b22222;">Put a circle on the graph
</span>        <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$item</span> = Gnome2::Canvas::Item-&gt;new(
                    $root, <span style="color: #008b00;">"Gnome2::Canvas::Ellipse"</span>,
                    <span style="color: #008b00;">x1</span>=&gt; $x-16,
                    <span style="color: #008b00;">y1</span>=&gt; $y-16,
                    <span style="color: #008b00;">x2</span>=&gt; $x+16,
                    <span style="color: #008b00;">y2</span>=&gt; $y+16,
                    <span style="color: #008b00;">fill_color</span> =&gt; $color,
                    <span style="color: #008b00;">outline_color</span>=&gt;<span style="color: #008b00;">"black"</span>);

        <span style="color: #b22222;"># </span><span style="color: #b22222;">Make it movable
</span>        $item-&gt;signal_connect(<span style="color: #008b00;">"event"</span>, \&amp;item_move);
    }
}

create_widgets();
place_objects_on_canvas();

Gtk2-&gt;main();
</pre>



</div>

</div>

<div id="outline-container-19" class="outline-2">
<h2 id="sec-19">Animation on the canvas </h2>
<div class="outline-text-2" id="text-19">




<pre class="src src-perl"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/perl
</span><span style="color: #b22222;">############################################################</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">Example of animation on the gnome canvas.
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">Dov Grobgeld
</span><span style="color: #b22222;">############################################################</span><span style="color: #b22222;">
</span>
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gtk2</span> <span style="color: #008b00;">'-init'</span>;
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">Gnome2::Canvas</span>;
<span style="color: #a020f0;">use</span> <span style="color: #0000ff;">strict</span>;

<span style="color: #a020f0;">my</span>(<span style="color: #b8860b;">$w_top</span>, <span style="color: #b8860b;">$w_canvas</span>);
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$min_x</span> = 5;
<span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$max_x</span> = 500;
<span style="color: #a020f0;">my</span> (<span style="color: #b8860b;">$rect_green</span>, <span style="color: #b8860b;">$rect_orange</span>);

<span style="color: #b22222;">############################################################</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">Create the widgets
</span><span style="color: #b22222;">############################################################</span><span style="color: #b22222;">
</span><span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">create_widgets</span> {
    $w_top = Gtk2::Window-&gt;new;
    $w_top-&gt;signal_connect(<span style="color: #008b00;">destroy</span>=&gt; <span style="color: #a020f0;">sub</span> { <span style="color: #a020f0;">exit</span> });

    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$vbox</span> = Gtk2::VBox-&gt;new(0,0);
    $w_top-&gt;add($vbox);

    $w_canvas = Gnome2::Canvas-&gt;new_aa();
    $vbox-&gt;pack_start($w_canvas, 1,1,0);
    $w_canvas-&gt;set_size_request(600, 300);
    $w_canvas-&gt;set_scroll_region(0, 0, 600, 300);

    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$quit</span> = Gtk2::Button-&gt;new(<span style="color: #008b00;">"Quit"</span>);
    $quit-&gt;signal_connect(<span style="color: #008b00;">clicked</span>=&gt; <span style="color: #a020f0;">sub</span> { <span style="color: #a020f0;">exit</span> });
    $vbox-&gt;pack_start($quit, 0, 0, 0);

    $w_top-&gt;show_all();
}

<span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">place_objects_on_canvas</span> {
    <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$root</span> = $w_canvas-&gt;root();

    $rect_green =<span style="text-decoration: underline;"> </span>
        Gnome2::Canvas::Item-&gt;new($root,
                                  <span style="color: #008b00;">"Gnome2::Canvas::Rect"</span>,
                                  <span style="color: #008b00;">x1</span>=&gt; 240,
                                  <span style="color: #008b00;">y1</span>=&gt; 90,
                                  <span style="color: #008b00;">x2</span>=&gt; 440,
                                  <span style="color: #008b00;">y2</span>=&gt; 180,
                                  <span style="color: #008b00;">fill_color_rgba</span>=&gt; 0x3cb37180,
                                  <span style="color: #008b00;">outline_color</span> =&gt; <span style="color: #008b00;">"black"</span>,
                                  <span style="color: #008b00;">width_units</span> =&gt;2.0);
    <span style="color: #b22222;"># </span><span style="color: #b22222;">Add user data
</span>    $rect_green-&gt;{<span style="color: #008b00;">dir</span>}=1;
    $rect_green-&gt;{<span style="color: #008b00;">speed</span>}=5;

    $rect_orange =<span style="text-decoration: underline;"> </span>
        Gnome2::Canvas::Item-&gt;new($root,
                                  <span style="color: #008b00;">"Gnome2::Canvas::Ellipse"</span>,
                                  <span style="color: #008b00;">x1</span>=&gt; 30,
                                  <span style="color: #008b00;">y1</span>=&gt; 150,
                                  <span style="color: #008b00;">x2</span>=&gt; 250,
                                  <span style="color: #008b00;">y2</span>=&gt; 240,
                                  <span style="color: #008b00;">fill_color_rgba</span>=&gt; 0xb3713c80,
                                  <span style="color: #008b00;">outline_color</span> =&gt; <span style="color: #008b00;">"black"</span>,
                                  <span style="color: #008b00;">width_units</span> =&gt;2.0);

    $rect_orange-&gt;{<span style="color: #008b00;">dir</span>} = -1;
    $rect_orange-&gt;{<span style="color: #008b00;">speed</span>} = 8;

    Glib::Timeout-&gt;add(10, \&amp;cb_animation_step);
}

<span style="color: #b22222;">############################################################</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">Takes one step of the animation. rect_green is moved by
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">DELTA_Y_GREEN and rect_orange by DELTA_Y_ORANGE. When they
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">meet the borders, their direction change
</span><span style="color: #b22222;">############################################################</span><span style="color: #b22222;">
</span><span style="color: #a020f0;">sub</span> <span style="color: #0000ff;">cb_animation_step</span> {
    <span style="color: #a020f0;">foreach</span> <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$r</span> ($rect_green, $rect_orange) {
        <span style="color: #b22222;"># </span><span style="color: #b22222;">Get old values
</span>        <span style="color: #a020f0;">my</span> (<span style="color: #b8860b;">$old_x1</span>, <span style="color: #b8860b;">$old_x2</span>) = $r-&gt;get(<span style="color: #008b00;">"x1"</span>, <span style="color: #008b00;">"x2"</span>);

        <span style="color: #b22222;"># </span><span style="color: #b22222;">Get user data
</span>        <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$dir</span> = $r-&gt;{<span style="color: #008b00;">dir</span>} || 1;
        <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$speed</span> = $r-&gt;{<span style="color: #008b00;">speed</span>};

        <span style="color: #b22222;"># </span><span style="color: #b22222;">Move the object
</span>        <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$new_x1</span> = $old_x1 + $dir * $speed;
        <span style="color: #a020f0;">my</span> <span style="color: #b8860b;">$new_x2</span> = $old_x2 + $dir * $speed;

        <span style="color: #b22222;"># </span><span style="color: #b22222;">Check if we hit a wall
</span>        <span style="color: #a020f0;">if</span> ($new_x1 &lt; $min_x || $new_x2 &gt; $max_x) {
            $dir = -$dir;
            $r-&gt;{<span style="color: #008b00;">dir</span>} = $dir;

            $new_x1 = $old_x1 + $dir * $speed;
            $new_x2 = $old_x2 + $dir * $speed;
        }

        <span style="color: #b22222;"># </span><span style="color: #b22222;">Update new parameter data
</span>        $r-&gt;set(<span style="color: #008b00;">x1</span> =&gt; $new_x1,
                <span style="color: #008b00;">x2</span> =&gt; $new_x2);
    }

    <span style="color: #b22222;"># </span><span style="color: #b22222;">As long as this routine returns TRUE, it will be
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">called again</span><span style="text-decoration: underline;"> </span><span style="color: #b22222;">
</span>    <span style="color: #a020f0;">return</span> 1;
}

create_widgets();
place_objects_on_canvas();

Gtk2-&gt;main();

</pre>


<p>
<img src="graphics/canvas_motion.png"  alt="graphics/canvas_motion.png" />
</p>
</div>

</div>

<div id="outline-container-20" class="outline-2">
<h2 id="sec-20">References </h2>
<div class="outline-text-2" id="text-20">

<ul>
<li>
Gtk Documentation.
</li>
<li>
GooCanvas documentation.
</li>
<li>
PerlGtk package.
</li>
</ul>

</div>

</div>

<div id="outline-container-21" class="outline-2">
<h2 id="sec-21">Thanks! </h2>
<div class="outline-text-2" id="text-21">


</div>
</div>

</div>
</body>
</html>
